(function(){"use strict";var e={2747:function(e,t,a){var i=a(144),s=a(1657),r=a(4886),n=a(2118),l=function(){var e=this,t=e._self._c;return t(s.Z,[t(n.Z,[t("h1",[e._v("DUSTER: Data Upload Service for Translational rEsearch on Redcap")])]),e.metadata_loaded?e._e():t(n.Z,[t(r.EB,[t("h2",{staticClass:"primary--text"},[e._v("Retrieving DUSTER metadata...")])])],1),e.metadata_loaded?t(n.Z,[t("NewProjectStepper")],1):e._e()],1)},o=[],d=a(6343),_=a(266),c=a(5093),p=a(5125),u=a(1713),m=a(3687),g=a(1798),h=a(8754),f=a(8491),w=function(){var e=this,t=e._self._c;return t(n.Z,[e.metadata_loaded?e._e():t(n.Z,[t(r.EB,[t("h2",{staticClass:"primary--text"},[e._v("Retrieving DUSTER metadata...")])])],1),e.metadata_loaded?t(n.Z,[t(g.Z,{attrs:{outlined:""},model:{value:e.step,callback:function(t){e.step=t},expression:"step"}},[t(h.Rp,[t(f.Z,{attrs:{complete:e.step>1,step:"1"}},[e._v(" Researcher-Provided Info ")]),t(c.Z),t(f.Z,{attrs:{complete:e.step>2,step:"2"}},[e._v(" Demographics ")]),t(c.Z),t(f.Z,{attrs:{complete:e.step>3,step:"3"}},[e._v(" Clinical Dates ")]),t(c.Z),t(f.Z,{attrs:{complete:e.step>4,step:"4"}},[e._v(" Clinical Data ")]),t(c.Z),t(f.Z,{attrs:{step:"5"}},[e._v(" Review ")])],1),t(h.gd,[t("ResearcherProvidedInfoStep",{attrs:{rp_identifiers_prop:e.rp_identifiers,rp_dates_prop:e.rp_dates},on:{"update:rp_identifiers_prop":function(t){e.rp_identifiers=t},"update:rp_dates_prop":function(t){e.rp_dates=t}}}),t("DemographicsStep",{attrs:{demographics_prop:e.demographics},on:{"update:demographics_prop":function(t){e.demographics=t}}}),t("ClinicalDatesStep"),t("DataCollectionWindowsStep",{attrs:{clinical_dates_prop:e.clinical_dates,collection_windows_prop:e.collection_windows,labs_prop:e.labs,rp_dates_prop:e.rp_dates,show_window_form_prop:e.show_window_form,vitals_prop:e.vitals},on:{"update:collection_windows_prop":function(t){e.collection_windows=t},"update:show_window_form_prop":function(t){e.show_window_form=t}}}),t("ReviewStep",{attrs:{collection_windows:e.collection_windows,create_project_url:e.urls.create_project,demographics:e.demographics,project_info:e.project_info,redcap_csrf_token:e.redcap_csrf_token,rp_dates:e.rp_dates}})],1)],1),t(u.Z,[t(_.Z,{directives:[{name:"show",rawName:"v-show",value:1==e.step,expression:"step == 1"}],attrs:{cols:"auto"}},[t(p.Z,{attrs:{action:"urls.new_project_intro",method:"post",id:"intro-form"}},[t(d.Z,{attrs:{color:"secondary",type:"submit"}},[e._v(" < Back to DUSTER Intro ")])],1)],1),t(_.Z,{directives:[{name:"show",rawName:"v-show",value:e.step>1,expression:"step > 1"}],attrs:{cols:"auto"}},[t(d.Z,{attrs:{color:"primary",disabled:e.show_window_form},on:{click:e.backStep}},[e._v(" < Back ")])],1),t(_.Z,{directives:[{name:"show",rawName:"v-show",value:e.step<5,expression:"step < 5"}],attrs:{cols:"auto"}},[t(d.Z,{attrs:{color:"primary",disabled:e.show_window_form},on:{click:e.nextStep}},[e._v(" Next > ")])],1),t(m.Z)],1)],1):e._e()],1)},v=[],b=(a(7658),a(196)),Z=a(4145),y=a(2112),x=a(3767),j=a(961),D=a(4598),k=a(5530),C=a(5157),S=a(1276),E=function(){var e=this,t=e._self._c;return t(C.Z,{attrs:{step:"1"}},[t(r.ZB,[t("p",[e._v(" There are identifiers and dates in your study cohort that you will provide for your REDCap project. "),t("br"),t("br"),e._v(" The minimum required information for each record is an MRN and a study enrollment date, which DUSTER will use to query STARR. "),t("br"),e._v(" Optionally, you may also add other date/datetimes of interest. "),t("br"),t("br"),e._v(" After DUSTER creates the project, you will be able to perform a bulk upload of the Researcher-Provided Info you define here. ")])]),t(c.Z),t(Z.Z,{staticClass:"mt-4",attrs:{outlined:""}},[t(r.Qq,[t("h1",[e._v("Identifier")])]),t(y.Z,{attrs:{headers:e.rp_id_headers,items:e.rp_identifiers,"item-key":"label","fixed-header":"",dense:"","hide-default-footer":""}})],1),t(Z.Z,{staticClass:"pb-2 mt-4",attrs:{outlined:""}},[t(r.Qq,[t("h1",[e._v("Dates")])]),t(y.Z,{staticClass:"mb-4",attrs:{headers:e.rp_date_headers,items:e.rp_dates,"item-key":"label","fixed-header":"",dense:"","hide-default-footer":""},scopedSlots:e._u([{key:"item.format",fn:function({item:a}){return[t("span",[e._v(e._s(a.format)+" ["+e._s("date"==a.format?"YYYY-MM-DD":"YYYY-MM-DD HH:MM:SS")+"]")])]}},{key:"item.actions",fn:function({item:a}){return[t(j.Z,{directives:[{name:"show",rawName:"v-show",value:a.id>0,expression:"item.id > 0"}],staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editRPDate(a.id)}}},[e._v(" mdi-pencil ")]),t(j.Z,{directives:[{name:"show",rawName:"v-show",value:a.id>0,expression:"item.id > 0"}],attrs:{small:""},on:{click:function(t){e.delete_date_index=a.id,e.delete_date_dialog=!0}}},[e._v(" mdi-delete ")])]}}],null,!0)}),t(x.Z,{attrs:{persistent:"","max-width":"600px"},scopedSlots:e._u([{key:"activator",fn:function({on:a,attrs:i}){return[t(d.Z,e._g(e._b({staticClass:"ml-2",attrs:{color:"primary"}},"v-btn",i,!1),a),[e._v(" Add New Date/Datetime ")])]}}]),model:{value:e.new_date_dialog,callback:function(t){e.new_date_dialog=t},expression:"new_date_dialog"}},[t(Z.Z,[t(p.Z,{ref:"date_form"},[t(r.EB,[t("span",{staticClass:"text-h5"},[e._v("New Date/Datetime")])]),t(r.ZB,[t(u.Z,[t(_.Z,{attrs:{cols:"12"}},[t(S.Z,{attrs:{rules:[e.rules.required,e.checkRCLabel],label:"Label",required:""},model:{value:e.new_date.label,callback:function(t){e.$set(e.new_date,"label",t)},expression:"new_date.label"}})],1)],1),t(u.Z,[t(_.Z,{attrs:{cols:"12"}},[t(S.Z,{attrs:{rules:[e.rules.required,e.checkRCFieldName],label:"REDCap field name",required:""},model:{value:e.new_date.redcap_field_name,callback:function(t){e.$set(e.new_date,"redcap_field_name",t)},expression:"new_date.redcap_field_name"}})],1)],1),t(u.Z,[t(_.Z,{attrs:{cols:"12"}},[t(k.Z,{attrs:{rules:[e.rules.required],required:"",label:"Format",row:""},model:{value:e.new_date.format,callback:function(t){e.$set(e.new_date,"format",t)},expression:"new_date.format"}},[t(D.Z,{attrs:{label:"Date",value:"date"}}),t(D.Z,{attrs:{label:"Datetime",value:"datetime"}})],1)],1)],1)],1),t(m.Z),t(r.h7,[t(d.Z,{attrs:{color:"primary"},on:{click:e.saveDateForm}},[e._v(" Submit ")]),t(d.Z,{attrs:{color:"secondary",type:"reset"},on:{click:e.resetDateForm}},[e._v(" Cancel ")])],1)],1)],1)],1),t(x.Z,{attrs:{persistent:"","max-width":"600px"},model:{value:e.edit_date_dialog,callback:function(t){e.edit_date_dialog=t},expression:"edit_date_dialog"}},[t(Z.Z,[t(p.Z,{ref:"edit_date_form"},[t(r.EB,[t("span",{staticClass:"text-h5"},[e._v("Edit Date/Datetime")])]),t(r.ZB,[t(u.Z,[t(_.Z,{attrs:{cols:"12"}},[t(S.Z,{attrs:{rules:[e.rules.required,e.checkRCLabelEdit],label:"Label",required:""},model:{value:e.edit_date.label,callback:function(t){e.$set(e.edit_date,"label",t)},expression:"edit_date.label"}})],1)],1),t(u.Z,[t(_.Z,{attrs:{cols:"12"}},[t(S.Z,{attrs:{rules:[e.rules.required,e.checkRCFieldNameEdit],label:"REDCap field name",required:""},model:{value:e.edit_date.redcap_field_name,callback:function(t){e.$set(e.edit_date,"redcap_field_name",t)},expression:"edit_date.redcap_field_name"}})],1)],1),t(u.Z,[t(_.Z,{attrs:{cols:"12"}},[t(k.Z,{attrs:{rules:[e.rules.required],required:"",label:"Format",row:""},model:{value:e.edit_date.format,callback:function(t){e.$set(e.edit_date,"format",t)},expression:"edit_date.format"}},[t(D.Z,{attrs:{label:"Date",value:"date"}}),t(D.Z,{attrs:{label:"Datetime",value:"datetime"}})],1)],1)],1)],1),t(m.Z),t(r.h7,[t(d.Z,{attrs:{color:"primary"},on:{click:function(t){return e.saveEditRPDate()}}},[e._v(" Save ")]),t(d.Z,{attrs:{color:"secondary",type:"reset"},on:{click:function(t){return e.resetEditDateForm()}}},[e._v(" Cancel ")])],1)],1)],1)],1),t(x.Z,{attrs:{persistent:"","max-width":"600px"},model:{value:e.delete_date_dialog,callback:function(t){e.delete_date_dialog=t},expression:"delete_date_dialog"}},[t(Z.Z,[t(r.EB,{staticClass:"justify-center"},[e._v(" Are you sure you want to delete this date? ")]),t(r.h7,[t(m.Z),t(d.Z,{attrs:{color:"error"},on:{click:function(t){return e.deleteRPDate()}}},[e._v(" Yes ")]),t(d.Z,{attrs:{color:"secondary"},on:{click:function(t){e.delete_date_index=null,e.delete_date_dialog=!1}}},[e._v(" Cancel ")]),t(m.Z)],1)],1)],1)],1)],1)},N=[],R={name:"ResearcherProvidedInfoStep",props:{rp_identifiers_prop:Array,rp_dates_prop:Array},computed:{rp_identifiers:{get(){return this.rp_identifiers_prop}},rp_dates:{get(){return this.rp_dates_prop},set(){this.$emit("update:rp_dates_prop",this.rp_dates)}}},data:function(){return{rp_id_headers:[{text:"Label",value:"label"},{text:"REDCap field name",value:"redcap_field_name"},{text:"Format",value:"format"}],rp_date_headers:[{text:"Label",value:"label"},{text:"REDCap field name",value:"redcap_field_name"},{text:"Format",value:"format"},{text:"Actions",value:"actions",sortable:!1}],new_date_dialog:!1,edit_date_index:null,edit_date_dialog:!1,delete_date_index:null,delete_date_dialog:!1,new_date:{id:null,label:null,redcap_field_name:null,format:null},edit_date:{label:null,redcap_field_name:null,format:null},rules:{required:e=>!!e||"Required."}}},methods:{saveDateForm(){this.$refs.date_form.validate(),this.new_date.id=this.rp_dates.length,this.rp_dates.push(this.new_date),this.resetDateForm()},resetDateForm(){this.new_date_dialog=!1,this.new_date={id:null,label:null,redcap_field_name:null,format:null},this.$refs.date_form.resetValidation()},editRPDate(e){this.edit_date_index=this.rp_dates.findIndex((t=>t.id===e)),this.edit_date=JSON.parse(JSON.stringify(this.rp_dates[this.edit_date_index])),this.edit_date_dialog=!0},saveEditRPDate(){this.$refs.edit_date_form.validate(),this.$set(this.rp_dates,this.edit_date_index,JSON.parse(JSON.stringify(this.edit_date))),this.resetEditDateForm()},resetEditDateForm(){this.edit_date_dialog=!1,this.edit_date_index=null,this.edit_date={id:null,label:null,redcap_field_name:null,format:null},this.$refs.edit_date_form.resetValidation()},deleteRPDate(){this.rp_dates.splice(this.delete_date_index,1),this.delete_date_index=null,this.delete_date_dialog=!1},checkRCLabel(e){let t=this.rp_dates.map((e=>e.label));return t=t.concat(this.clinical_dates),!t.includes(e)||"Enter another label. This label is already used by a predefined clinical date or other researcher-provided date."},checkRCLabelEdit(e){let t=this.rp_dates.map((e=>e.label));return t=t.concat(this.clinical_dates),!t.includes(e)||e===this.rp_dates[this.edit_date_index].label||"Enter another label. This label is already used by a predefined clinical date or other researcher-provided date."},checkRCFieldName(e){if(!/^[a-z0-9_]+$/.test(e))return"ONLY lowercase letters, numbers, and underscores.";let t=this.rp_dates.map((e=>e.redcap_field_name));return!t.includes(e)||"Enter another field name. This field name is already taken."},checkRCFieldNameEdit(e){if(!/^[a-z0-9_]+$/.test(e))return"ONLY letters, numbers, and underscores.";let t=this.rp_dates.map((e=>e.redcap_field));return!t.includes(e)||e===this.rp_dates[this.edit_date_index].redcap_field_name||"Enter another field name. This field name is already taken."}}},O=R,A=a(1001),P=(0,A.Z)(O,E,N,!1,null,"afc59564",null),L=P.exports,$=a(7921),T=function(){var e=this,t=e._self._c;return t(C.Z,{attrs:{step:"2"}},[t(r.ZB,{attrs:{flat:""}},[t("p",[e._v(" Select demographics below that you'd like to collect on your cohort. "),t("br"),t("br"),t("em",[e._v("Please bear in mind HIPAA Minimum Necessary when selecting identifying information.")])])]),t(n.Z,[e._l(e.demographics.options,(function(a){return t($.Z,{key:a.id,attrs:{label:a.label,value:a,dense:""},model:{value:e.demographics.selected,callback:function(t){e.$set(e.demographics,"selected",t)},expression:"demographics.selected"}})})),t(d.Z,{attrs:{color:"primary"},on:{click:e.toggleAllDemo}},[e._v(" Select/Unselect All ")])],2)],1)},M=[],F={name:"DemographicsStep",props:{demographics_prop:Object},computed:{demographics:{get(){return this.demographics_prop},set(){this.$emit("update:demographics_prop",this.demographics)}}},data:function(){return{}},methods:{toggleAllDemo(){this.demographics.selected.length!=this.demographics.options.length?this.demographics.selected=this.demographics.options:this.demographics.selected=[]}}},V=F,q=(0,A.Z)(V,T,M,!1,null,"5b296634",null),I=q.exports,W=function(){var e=this,t=e._self._c;return t("div")},B=[],J={name:"ClinicalDatesStep.vue"},Y=J,U=(0,A.Z)(Y,W,B,!1,null,"35b92bbe",null),H=U.exports,z=a(3959),Q=a(2936),G=a(4874),X=a(255),K=a(2348),ee=a(400),te=a(8074),ae=a(326),ie=a(4455),se=a(626),re=a(2165),ne=a(957),le=a(6839),oe=function(){var e=this,t=e._self._c;return t(C.Z,{attrs:{step:"4"}},[t(r.ZB,[t("p",[e._v(" Clinical data is partly defined by relative windows of time. "),t("br"),t("br"),e._v(" DUSTER uses Data Collection Windows to apply this concept of creating windows of time in which you'd like to gather clinical data. "),t("br"),e._v(" Each Data Collection Window will appear in the form of REDCap Instruments in your project. "),t("br"),e._v(" Within each window, you may add your desired clinical data. "),t("br"),t("br"),e._v(" You may create Data Collection Windows below with the options to choose among preset configurations or to configure from scratch. ")])]),t(Z.Z,[t(r.Qq,{directives:[{name:"show",rawName:"v-show",value:e.collection_windows.length,expression:"collection_windows.length"}]},[t("h1",[e._v("Data Collection Windows")])]),t(te.Z,{staticClass:"mb-4",attrs:{focusable:"",disabled:!0===e.show_window_form},model:{value:e.open_window_panel,callback:function(t){e.open_window_panel=t},expression:"open_window_panel"}},e._l(e.collection_windows,(function(a,i){return t(X.Z,{key:i},[t(ee.Z,[e._v(" "+e._s(a.label)+" ")]),t(K.Z,[t(Z.Z,{attrs:{outlined:""}},[t(u.Z,[t(_.Z,[t(Z.Z,{attrs:{outlined:""}},[t(r.EB,[e._v("Timing")]),"nonrepeating"===a.type?t(r.ZB,[t("p",[e._v(" Start: "+e._s("date"===a.timing.start_type?"At 00:00:00 on ":"")+" "+e._s(a.timing.start.label)+" ")]),"hours"===a.timing.end_type?t("p",[e._v(" End: "+e._s(a.timing.num_hours)+" hours after "+e._s(a.timing.start.label)+" ")]):"day"===a.timing.end_type?t("p",[e._v(" End: At 23:59:00 on "+e._s(a.timing.start.label)+" ")]):"dttm"===a.timing.end_type?t("p",[e._v(" End: "+e._s(a.timing.end.label)+" ")]):e._e()]):"finite_repeating"===a.type?t(r.ZB,[t("p",[e._v(" This data collection window repeats for "+e._s(a.timing.num_instances)+" consecutive "+e._s("hours"===a.timing.type?a.timing.num_hours+"-hour instances.":"calendar day instances.")),t("br"),e._v(" The first instance begins at "+e._s(a.timing.start.label)+"."),t("br"),e._v(" Each instance ends "+e._s("hours"===a.timing.type?a.timing.num_hours+" hours after it begins.":"at 23:59:00 on the calendar day it begins.")),t("br")])]):"calculated_repeating"===a.type?t(r.ZB,[t("p",[e._v(" This data collection window repeats for consecutive "+e._s("hours"===a.timing.type?"-hour instances.":"calendar day instances.")),t("br"),e._v(" The first instance begins at "+e._s(a.timing.start.label)+"."),t("br"),e._v(" Each instance ends "+e._s("hours"===a.timing.type?a.timing.num_hours+" hours after it begins.":"at 23:59:00 on the calendar day it begins.")),t("br"),e._v(" The last instance ends at "+e._s(a.timing.end.label)+"."),t("br")])]):e._e()],1)],1)],1),t(u.Z,[t(_.Z,[t(Z.Z,{attrs:{outlined:""}},[t(r.Qq,[e._v("Default Aggregates")]),t(r.ZB,[1==a.aggregate_defaults.min?t(G.Z,[e._v(" Min ")]):e._e(),1==a.aggregate_defaults.max?t(G.Z,[e._v(" Max ")]):e._e(),1==a.aggregate_defaults.first?t(G.Z,[e._v(" First ")]):e._e(),1==a.aggregate_defaults.last?t(G.Z,[e._v(" Last ")]):e._e(),1==a.aggregate_defaults.closest_start?t(G.Z,[e._v(" Closest to "+e._s(a.timing.start.label)+" ")]):e._e(),1==a.aggregate_defaults.closest_time?t(G.Z,[e._v(" Closest to "+e._s(a.aggregates.closest_timestamp)+" ")]):e._e()],1)],1)],1)],1),t(u.Z,[t(_.Z,[t(Z.Z,{attrs:{outlined:""}},[t(ne.Z,{attrs:{"background-color":"primary",dark:""}},[t(se.Z,[e._v("Labs & Vitals")]),t(re.Z,[t(Z.Z,[t(y.Z,{attrs:{headers:e.lv_headers_viewonly,items:a.data.labs_vitals,"items-per-page":10,"fixed-header":"","no-data-text":"Use search bar above to start adding labs and vitals."},scopedSlots:e._u([{key:"item.aggregates",fn:function({item:i}){return[t(G.Z,{directives:[{name:"show",rawName:"v-show",value:1==i.aggregates.default,expression:"item.aggregates.default == true"}]},[e._v(" Using Default Aggregates ")]),t(G.Z,{directives:[{name:"show",rawName:"v-show",value:0==i.aggregates.default&&1==i.aggregates.min,expression:"item.aggregates.default == false && item.aggregates.min == true"}]},[e._v(" Min ")]),t(G.Z,{directives:[{name:"show",rawName:"v-show",value:0==i.aggregates.default&&1==i.aggregates.max,expression:"item.aggregates.default == false && item.aggregates.max == true"}]},[e._v(" Max ")]),t(G.Z,{directives:[{name:"show",rawName:"v-show",value:0==i.aggregates.default&&1==i.aggregates.first,expression:"item.aggregates.default == false && item.aggregates.first == true"}]},[e._v(" First ")]),t(G.Z,{directives:[{name:"show",rawName:"v-show",value:0==i.aggregates.default&&1==i.aggregates.last,expression:"item.aggregates.default == false && item.aggregates.last == true"}]},[e._v(" Last ")]),t(G.Z,{directives:[{name:"show",rawName:"v-show",value:0==i.aggregates.default&&1==i.aggregates.closest_start,expression:"item.aggregates.default == false && item.aggregates.closest_start == true"}]},[e._v(" Closest to "+e._s(a.timing.start.label)+" ")]),t(G.Z,{directives:[{name:"show",rawName:"v-show",value:0==i.aggregates.default&&1==i.aggregates.closest_time,expression:"item.aggregates.default == false && item.aggregates.closest_time == true"}]},[e._v(" Closest to "+e._s(i.aggregates.closest_timestamp)+" ")])]}}],null,!0)})],1)],1)],1)],1)],1)],1)],1),t(r.h7,{directives:[{name:"show",rawName:"v-show",value:e.edit_window_index===i,expression:"edit_window_index === i"}],staticClass:"mt-4"},[t(d.Z,{attrs:{color:"secondary"},on:{click:function(t){e.edit_window_index=-1,e.cancelEditWindow(i)}}},[e._v(" Cancel Edit ")])],1),t(d.Z,{directives:[{name:"show",rawName:"v-show",value:-1===e.edit_window_index,expression:"edit_window_index === -1"}],attrs:{color:"primary"},on:{click:function(t){return e.editWindow(i)}}},[e._v(" Edit ")]),t(d.Z,{directives:[{name:"show",rawName:"v-show",value:-1===e.edit_window_index,expression:"edit_window_index === -1"}],attrs:{color:"error"},on:{click:function(t){e.delete_window_dialog=!0}}},[e._v(" Delete ")]),t(x.Z,{attrs:{persistent:"","max-width":"1000px"},model:{value:e.delete_window_dialog,callback:function(t){e.delete_window_dialog=t},expression:"delete_window_dialog"}},[t(Z.Z,[t(r.EB,{staticClass:"justify-center"},[e._v(" Are you sure you want to delete this Data Collection Window? ")]),t(r.h7,[t(m.Z),t(d.Z,{attrs:{color:"error"},on:{click:function(t){return e.deleteWindow(i)}}},[e._v(" Yes ")]),t(d.Z,{attrs:{color:"secondary"},on:{click:function(t){e.delete_window_dialog=!1}}},[e._v(" Cancel ")]),t(m.Z)],1)],1)],1)],1)],1)})),1),t(Z.Z,{directives:[{name:"show",rawName:"v-show",value:!0===e.show_window_form,expression:"show_window_form === true"}],attrs:{outlined:""}},[t(r.Qq,[t("h1",[e._v(e._s(-1===e.edit_window_index?"Create a New":"Edit")+" Data Collection Window")])]),t(g.Z,{attrs:{vertical:""},model:{value:e.window_stepper,callback:function(t){e.window_stepper=t},expression:"window_stepper"}},[t(f.Z,{attrs:{complete:e.window_stepper>1,step:"1",editable:""}},[e._v(" Set Timing ")]),t(C.Z,{attrs:{step:"1"}},[t(p.Z,{ref:"window_form"},[t(u.Z,[t(_.Z,{attrs:{cols:"6"}},[t(ae.Z,{ref:"preset_window",attrs:{items:e.preset_windows,label:"Presets","item-text":"label","return-object":""},on:{change:function(t){return e.setPreset(e.preset_choice)}},model:{value:e.preset_choice,callback:function(t){e.preset_choice=t},expression:"preset_choice"}})],1)],1),t(u.Z,[t(_.Z,{attrs:{cols:"6"}},[t(S.Z,{attrs:{rules:[e.rules.required,e.checkInstrName],label:"Data Collection Window Name",required:""},model:{value:e.window.label,callback:function(t){e.$set(e.window,"label",t)},expression:"window.label"}})],1)],1),"nonrepeating"===e.window.type?t(k.Z,{attrs:{label:"When should this window start?"},model:{value:e.window.timing.start_type,callback:function(t){e.$set(e.window.timing,"start_type",t)},expression:"window.timing.start_type"}},[t(D.Z,{staticClass:"pl-3",attrs:{value:"dttm"},scopedSlots:e._u([{key:"label",fn:function(){return[t(u.Z,{attrs:{align:"center","no-gutters":""}},[t(_.Z,{attrs:{cols:"auto"}},[e._v(" At a specified Date/Datetime of Interest. ")]),t(_.Z,[t(le.Z,{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:a,attrs:i}){return[t(j.Z,e._g(e._b({attrs:{color:"primary",dark:""}},"v-icon",i,!1),a),[e._v(" mdi-information-outline ")])]}}],null,!1,2517027790)},[t("span",[e._v("If the specified Date of Interest is not a Datetime, 00:00:00 will be used for the date's timestamp.")])])],1)],1)]},proxy:!0}],null,!1,593794010)}),t(D.Z,{staticClass:"pl-3",attrs:{label:"At 00:00:00 on a specified Date/Datetime of Interest.",value:"date"}})],1):e._e(),t(u.Z,[t(_.Z,{attrs:{cols:"4"}},[e.window.timing.start_type||["finite_repeating","calculated_repeating"].includes(e.window.type)?t(ae.Z,{attrs:{items:e.window_dates,"item-text":"label","item-value":"label","return-object":"",label:"Date/Datetime of Interest"},model:{value:e.window.timing.start,callback:function(t){e.$set(e.window.timing,"start",t)},expression:"window.timing.start"}}):e._e()],1),e.isClinicalDate(e.window.timing.start)?t(_.Z,{attrs:{cols:"4"}},[t(ae.Z,{attrs:{items:e.rp_dates,"item-text":"label","item-value":"redcap_field_name",label:"based on",hint:"To identify the Date/Datetime of Interest, this date/datetime must fall within the same hospital encounter.","persistent-hint":""},model:{value:e.window.timing.start_based,callback:function(t){e.$set(e.window.timing,"start_based",t)},expression:"window.timing.start_based"}})],1):e._e()],1),"nonrepeating"===e.window.type&&e.window.timing.start?t(k.Z,{attrs:{label:"When should this window end?"},on:{change:function(t){return e.resetNonRepeatEnd(e.window)}},model:{value:e.window.timing.end_type,callback:function(t){e.$set(e.window.timing,"end_type",t)},expression:"window.timing.end_type"}},[t(D.Z,{staticClass:"pl-3",attrs:{value:"hours"},scopedSlots:e._u([{key:"label",fn:function(){return[t(u.Z,{attrs:{align:"center","no-gutters":""}},[t(_.Z,{staticClass:"pr-1",attrs:{cols:"auto"}},[e._v(" This window ends ")]),t(_.Z,{staticClass:"pr-1",attrs:{sm:"1",cols:"1"}},[t(S.Z,{attrs:{dense:"",type:"number",min:"1"},model:{value:e.window.timing.num_hours,callback:function(t){e.$set(e.window.timing,"num_hours",e._n(t))},expression:"window.timing.num_hours"}})],1),t(_.Z,{attrs:{cols:"auto"}},[e._v(" hour(s) after "+e._s(e.window.timing.start.label)+". ")])],1)]},proxy:!0}],null,!1,2942363280)}),t(D.Z,{staticClass:"pl-3",attrs:{value:"day"},scopedSlots:e._u([{key:"label",fn:function(){return[e._v(" This window ends on 23:59 on the same calendar date of "+e._s(e.window.timing.start.label)+". ")]},proxy:!0}],null,!1,1802372449)}),t(D.Z,{staticClass:"pl-3",attrs:{label:"This window ends on a specified date/datetime.",value:"dttm"}})],1):e._e(),["finite_repeating","calculated_repeating"].includes(e.window.type)?t(k.Z,{attrs:{label:"How should this data collection window be repeated?"},on:{change:function(t){return e.resetRepeat(e.window)}},model:{value:e.window.timing.type,callback:function(t){e.$set(e.window.timing,"type",t)},expression:"window.timing.type"}},[t(D.Z,{attrs:{value:"hours"},scopedSlots:e._u([{key:"label",fn:function(){return[t(u.Z,{attrs:{align:"center","no-guters":""}},[t(_.Z,{staticClass:"pr-1",attrs:{cols:"auto"}},[e._v(" Each instance ends ")]),t(_.Z,{staticClass:"pr-1",attrs:{cols:"1"}},[t(S.Z,{attrs:{dense:"",type:"number",min:"1"},model:{value:e.window.timing.num_hours,callback:function(t){e.$set(e.window.timing,"num_hours",t)},expression:"window.timing.num_hours"}})],1),t(_.Z,{attrs:{cols:"auto"}},[e._v(" hour(s) after its respective start datetime. ")])],1)]},proxy:!0}],null,!1,3532630347)}),t(D.Z,{attrs:{value:"days"},scopedSlots:e._u([{key:"label",fn:function(){return[t("div",[e._v("Calendar day intervals (e.g., every day of an inpatient admission)")])]},proxy:!0}],null,!1,2773717728)})],1):e._e(),t(u.Z,[t(_.Z,{attrs:{cols:"4"}},["nonrepeating"===e.window.type&&"dttm"===e.window.timing.end_type||"calculated_repeating"===e.window.type?t(ae.Z,{attrs:{items:e.window_dates,"item-text":"label","item-value":"label","return-object":"",label:"End Date/Datetime"},model:{value:e.window.timing.end,callback:function(t){e.$set(e.window.timing,"end",t)},expression:"window.timing.end"}}):e._e()],1),t(_.Z,{attrs:{cols:"4"}},[e.isClinicalDate(e.window.timing.end)?t(ae.Z,{attrs:{label:"based on","item-text":"label","item-value":"redcap_field_name",items:e.rp_dates,hint:"To identify the End Date/Datetime, this date/datetime must fall within the same hospital encounter.","persistent-hint":""},model:{value:e.window.timing.end_based,callback:function(t){e.$set(e.window.timing,"end_based",t)},expression:"window.timing.end_based"}}):e._e()],1)],1),t(d.Z,{attrs:{color:"error",type:"reset"},on:{click:function(t){return e.resetWindow("window","window_form")}}},[e._v(" Reset Timing ")])],1)],1),t(f.Z,{attrs:{step:"2",editable:e.isValidTiming()}},[e._v(" Add Clinical Data ")]),t(C.Z,{attrs:{step:"2"}},[t(u.Z,[t(_.Z,[t(Z.Z,{attrs:{outlined:""}},[t(r.EB,[e._v("Set default aggregates")]),t(r.ZB,[t("p",[e._v(" Clinical variables that are added and require aggregation will default to the given settings here for convenience. "),t("br"),e._v(" Such variables may have their settings individually changed after being added. ")]),t(u.Z,{attrs:{"no-gutters":""}},[t(_.Z,{attrs:{cols:"1"}},[t($.Z,{attrs:{dense:"",label:"Min"},model:{value:e.window.aggregate_defaults.min,callback:function(t){e.$set(e.window.aggregate_defaults,"min",t)},expression:"window.aggregate_defaults.min"}})],1),t(_.Z,{staticClass:"pl-1",attrs:{cols:"1"}},[t($.Z,{attrs:{dense:"",label:"Max"},model:{value:e.window.aggregate_defaults.max,callback:function(t){e.$set(e.window.aggregate_defaults,"max",t)},expression:"window.aggregate_defaults.max"}})],1)],1)],1)],1)],1)],1),t(u.Z,[t(_.Z,[t(Z.Z,{attrs:{outlined:""}},[t(ne.Z,{attrs:{"background-color":"primary",dark:""}},[t(se.Z,[e._v("Labs & Vitals")]),t(se.Z,[e._v("Outcomes")]),t(se.Z,[e._v("Scores")]),t(re.Z,[t(Z.Z,[t(Q.Z,{attrs:{items:e.labs_vitals,color:"white","auto-select-first":"","hide-no-data":"",placeholder:"Search for labs and vitals to add...","prepend-icon":"mdi-magnify","item-text":"label","return-object":""},on:{change:e.addLV},model:{value:e.new_lv_obj,callback:function(t){e.new_lv_obj=t},expression:"new_lv_obj"}}),t(x.Z,{attrs:{persistent:"","max-width":"600px"},model:{value:e.edit_lv_dialog,callback:function(t){e.edit_lv_dialog=t},expression:"edit_lv_dialog"}},[t(Z.Z,[t(r.EB,{staticClass:"justify-center"},[e._v(" Edit aggregates for this clinical variable ")]),t(k.Z,{attrs:{column:""},model:{value:e.edit_lv_obj.aggregates.default,callback:function(t){e.$set(e.edit_lv_obj.aggregates,"default",t)},expression:"edit_lv_obj.aggregates.default"}},[t(D.Z,{attrs:{label:"Use default aggregates",value:!0}}),t(D.Z,{attrs:{label:"Set custom aggregates",value:!1}})],1),t(Z.Z,{directives:[{name:"show",rawName:"v-show",value:!e.edit_lv_obj.aggregates.default,expression:"!edit_lv_obj.aggregates.default"}],attrs:{flat:""}},[t(u.Z,{attrs:{"no-gutters":""}},[t(_.Z,{attrs:{cols:"2"}},[t($.Z,{attrs:{dense:"",label:"Min"},model:{value:e.edit_lv_obj.aggregates.min,callback:function(t){e.$set(e.edit_lv_obj.aggregates,"min",t)},expression:"edit_lv_obj.aggregates.min"}})],1),t(_.Z,{attrs:{cols:"2"}},[t($.Z,{attrs:{dense:"",label:"Max"},model:{value:e.edit_lv_obj.aggregates.max,callback:function(t){e.$set(e.edit_lv_obj.aggregates,"max",t)},expression:"edit_lv_obj.aggregates.max"}})],1)],1)],1),t(r.h7,[t(m.Z),t(d.Z,{attrs:{color:"primary"},on:{click:e.confirmEditLV}},[e._v(" Save ")]),t(d.Z,{attrs:{color:"secondary"},on:{click:e.closeEditLV}},[e._v(" Cancel ")]),t(m.Z)],1)],1)],1),t(x.Z,{attrs:{persistent:"","max-width":"600px"},model:{value:e.delete_lv_dialog,callback:function(t){e.delete_lv_dialog=t},expression:"delete_lv_dialog"}},[t(Z.Z,[t(r.EB,{staticClass:"justify-center"},[e._v(" Are you sure you want to delete this clinical variable? ")]),t(r.h7,[t(m.Z),t(d.Z,{attrs:{color:"error"},on:{click:e.confirmDeleteLV}},[e._v(" Yes ")]),t(d.Z,{attrs:{color:"secondary"},on:{click:e.closeDeleteLV}},[e._v(" Cancel ")]),t(m.Z)],1)],1)],1),t(ie.Z,{attrs:{color:"success",outlined:"",timeout:"1000"},model:{value:e.alert_lv_success,callback:function(t){e.alert_lv_success=t},expression:"alert_lv_success"}},[e._v(" "+e._s(e.alert_lv_label)+" added. ")]),t(ie.Z,{attrs:{color:"error",outlined:"",timeout:"1000"},model:{value:e.alert_lv_error,callback:function(t){e.alert_lv_error=t},expression:"alert_lv_error"}},[e._v(" "+e._s(e.alert_lv_label)+" was already added. ")]),t(y.Z,{attrs:{headers:e.lv_headers,items:e.window.data.labs_vitals,"items-per-page":10,"fixed-header":"","no-data-text":"Use search bar above to start adding labs and vitals."},scopedSlots:e._u([{key:"item.aggregates",fn:function({item:a}){return[t(G.Z,{directives:[{name:"show",rawName:"v-show",value:1==a.aggregates.default,expression:"item.aggregates.default == true"}]},[e._v(" Using Default Aggregates ")]),t(G.Z,{directives:[{name:"show",rawName:"v-show",value:0==a.aggregates.default&&1==a.aggregates.min,expression:"item.aggregates.default == false && item.aggregates.min == true"}]},[e._v(" Min ")]),t(G.Z,{directives:[{name:"show",rawName:"v-show",value:0==a.aggregates.default&&1==a.aggregates.max,expression:"item.aggregates.default == false && item.aggregates.max == true"}]},[e._v(" Max ")]),t(G.Z,{directives:[{name:"show",rawName:"v-show",value:0==a.aggregates.default&&1==a.aggregates.first,expression:"item.aggregates.default == false && item.aggregates.first == true"}]},[e._v(" First ")]),t(G.Z,{directives:[{name:"show",rawName:"v-show",value:0==a.aggregates.default&&1==a.aggregates.last,expression:"item.aggregates.default == false && item.aggregates.last == true"}]},[e._v(" Last ")]),t(G.Z,{directives:[{name:"show",rawName:"v-show",value:0==a.aggregates.default&&1==a.aggregates.closest_start,expression:"item.aggregates.default == false && item.aggregates.closest_start == true"}]},[e._v(" Closest to "+e._s(e.window.timing.start.label)+" ")]),t(G.Z,{directives:[{name:"show",rawName:"v-show",value:0==a.aggregates.default&&1==a.aggregates.closest_time,expression:"item.aggregates.default == false && item.aggregates.closest_time == true"}]},[e._v(" Closest to "+e._s(a.aggregates.closest_timestamp)+" ")])]}},{key:"item.actions",fn:function({item:a}){return[t(j.Z,{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editLV(a)}}},[e._v(" mdi-pencil ")]),t(j.Z,{attrs:{small:""},on:{click:function(t){return e.deleteLV(a)}}},[e._v(" mdi-delete ")])]}}],null,!0)})],1)],1),t(re.Z,[t(Z.Z,[t(r.ZB,[e._v("Outcomes is not currently available.")])],1)],1),t(re.Z,[t(Z.Z,[t(r.ZB,[e._v("Scores is not currently available.")])],1)],1)],1)],1)],1)],1),t(r.h7,[t(d.Z,{attrs:{color:"primary"},on:{click:function(t){return e.saveCollectionWindowForm()}}},[e._v(" Save Window ")])],1),t(z.Z,{attrs:{type:"error",dismissible:""},model:{value:e.alert_default_agg,callback:function(t){e.alert_default_agg=t},expression:"alert_default_agg"}},[e._v(" One or more clinical variables that you added are using default aggregates, but you did not set them. Set default aggregates in order to continue. ")])],1)],1),t(r.h7,{directives:[{name:"show",rawName:"v-show",value:!0===e.show_window_form,expression:"show_window_form === true"}],staticClass:"mt-4"},[t(d.Z,{attrs:{color:"secondary"},on:{click:function(t){e.edit_window_index=-1,e.show_window_form=!1,e.resetWindow("window","window_form")}}},[e._v(" Cancel ")])],1)],1),t(d.Z,{directives:[{name:"show",rawName:"v-show",value:!1===e.show_window_form,expression:"show_window_form === false"}],attrs:{color:"primary"},on:{click:function(t){e.show_window_form=!0,e.open_window_panel=null}}},[e._v(" Add New Data Collection Window ")])],1)],1)},de=[],_e={name:"DataCollectionWindowsStep",props:{clinical_dates_prop:Array,collection_windows_prop:Array,labs_prop:Array,vitals_prop:Array,rp_dates_prop:Array,show_window_form_prop:Boolean},computed:{clinical_dates:{get(){return this.clinical_dates_prop}},collection_windows:{get(){return this.collection_windows_prop},set(){this.$emit("update:collection_windows_prop",this.collection_windows)}},labs:{get(){return this.labs_prop}},labs_vitals:{get(){let e=this.labs;e.sort(((e,t)=>e.label.localeCompare(t.label))),e=[{header:"Labs"}].concat(e);let t=this.vitals;t.sort(((e,t)=>e.label.localeCompare(t.label))),t=[{header:"Vitals"}].concat(t);let a=e.concat([{divider:!0}]);return a.concat(t)}},rp_dates:{get(){return this.rp_dates_prop}},rp_dates_rcfields:{get(){return this.rp_dates.map((e=>e.redcap_field_name))}},show_window_form:{get(){return this.show_window_form_prop},set(e){this.$emit("update:show_window_form_prop",e)}},vitals:{get(){return this.vitals_prop}},window_dates:{get(){return this.clinical_dates.concat(this.rp_dates)}}},data:function(){return{alert_default_agg:!1,alert_lv_success:!1,alert_lv_error:!1,alert_lv_label:null,delete_lv_dialog:!1,delete_window_dialog:!1,edit_lv_dialog:!1,edit_lv_index:null,edit_lv_obj:{label:null,aggregates:{default:!0,min:!1,max:!1,first:!1,last:!1,closest_start:!1,closest_time:!1,closest_timestamp:"08:00:00"}},edit_window_index:-1,lv_headers:[{text:"Label",value:"label"},{text:"Aggregates",value:"aggregates",sortable:!1},{text:"Actions",value:"actions",sortable:!1}],lv_headers_viewonly:[{text:"Label",value:"label"},{text:"Aggregates",value:"aggregates",sortable:!1}],new_lv_obj:{duster_field_name:null,label:null,category:null},open_window_panel:null,window_stepper:1,preset_choice:null,preset_windows:[{label:"ED Presentation to ED Discharge",type:"nonrepeating",timing:{start_type:"dttm",start:{category:"dates",duster_field_name:"ed_admission_dttm",label:"ED Admission Datetime"},start_based:"enroll_date",end_type:"dttm",num_hours:null,end:{category:"dates",duster_field_name:"ed_discharge_dttm",label:"ED Discharge Datetime"},end_based:"enroll_date"},aggregate_defaults:{min:!1,max:!1,first:!1,last:!1,closest_start:!1,closest_time:!1,closest_timestamp:"08:00:00"},data:{labs_vitals:[]}},{label:"Hospital Presentation to Hospital Discharge",type:"nonrepeating",timing:{start_type:"dttm",start:{category:"dates",duster_field_name:"hospital_admit_dttm",label:"Hospital Admission Datetime"},start_based:"enroll_date",end_type:"dttm",num_hours:null,end:{category:"dates",duster_field_name:"hospital_discharge_dttm",label:"Hospital Discharge Datetime"},end_based:"enroll_date"},aggregate_defaults:{min:!1,max:!1,first:!1,last:!1,closest_start:!1,closest_time:!1,closest_timestamp:"08:00:00"},data:{labs_vitals:[]}},{label:"First 24 Hours of Hospital Admission",type:"nonrepeating",timing:{start_type:"dttm",start:{category:"dates",duster_field_name:"hospital_admit_dttm",label:"Hospital Admission Datetime"},start_based:"enroll_date",end_type:"hours",num_hours:24,end:null,end_based:"enroll_date"},aggregate_defaults:{min:!1,max:!1,first:!1,last:!1,closest_start:!1,closest_time:!1,closest_timestamp:"08:00:00"},data:{labs_vitals:[]}},{label:"First 24 Hours of First ICU Admission",type:"nonrepeating",timing:{start_type:"dttm",start:{category:"dates",duster_field_name:"first_icu_admission_dttm",label:"First ICU Admission Datetime"},start_based:"enroll_date",end_type:"hours",num_hours:24,end:null,end_based:"enroll_date"},aggregate_defaults:{min:!1,max:!1,first:!1,last:!1,closest_start:!1,closest_time:!1,closest_timestamp:"08:00:00"},data:{labs_vitals:[]}}],window_edit:!1,window:{label:null,type:"nonrepeating",timing:{start_type:null,start:null,start_based:"enroll_date",end_type:null,num_hours:null,end:null,end_based:"enroll_date"},aggregate_defaults:{min:!1,max:!1,first:!1,last:!1,closest_start:!1,closest_time:!1,closest_timestamp:"08:00:00"},data:{labs_vitals:[]}},rules:{required:e=>!!e||"Required."}}},methods:{addLV(){this.alert_lv_label=this.new_lv_obj.label,this.window.data.labs_vitals.map((e=>e.label)).includes(this.new_lv_obj.label)?this.alert_lv_error=!0:(this.window.data.labs_vitals.push(JSON.parse(JSON.stringify({duster_field_name:this.new_lv_obj.duster_field_name,label:this.new_lv_obj.label,category:this.new_lv_obj.category,aggregates:{default:!0,min:!1,max:!1,first:!1,last:!1,closest_start:!1,closest_time:!1,closest_timestamp:"08:00:00"}}))),this.alert_lv_success=!0),this.new_lv_obj={duster_field_name:null,label:null,category:null}},checkDefaultAgg(e){let t=!0;for(let a in e.aggregate_defaults)if(!0===e.aggregate_defaults[a]){t=!1;break}for(let a=0;a<e.data.labs_vitals.length;a++)if(!0===e.data.labs_vitals[a].aggregates.default&&!0===t)return!1;return!0},cancelEditWindow(e){this.collection_windows.splice(e,1,JSON.parse(JSON.stringify(this.pre_edit_window))),this.pre_edit_window=Object.assign({},this.pre_edit_window,null),this.edit_window_stepper=1,this.show_window_form=!1,this.$refs.window_form.resetValidation()},checkInstrName(e){let t=this.collection_windows.map((e=>e.label));return t=t.concat(["Researcher-Provided Info","Clinical Dates","Demographics"]),!t.includes(e)||!0===this.window_edit&&t[this.edit_window_index]===e||"Enter another name. This name is already used by another data collection window or other REDCap Form DUSTER will create by default."},closeDeleteLV(){this.delete_lv_dialog=!1},confirmDeleteLV(){this.window.data.labs_vitals.splice(this.edit_lv_index,1),this.edit_lv_index=null,this.closeDeleteLV()},confirmEditLV(){null!==this.edit_lv_index&&Object.assign(this.window.data.labs_vitals[this.edit_lv_index],this.edit_lv_obj),this.edit_lv_index=null,this.edit_lv_obj={duster_field_name:null,label:null,category:null,aggregates:{default:!0,min:!1,max:!1,first:!1,last:!1,closest_start:!1,closest_time:!1,closest_timestamp:"08:00:00"}},this.closeEditLV()},closeEditLV(){this.edit_lv_dialog=!1},deleteLV(e){this.edit_lv_index=this.window.data.labs_vitals.indexOf(e),this.delete_lv_dialog=!0},deleteWindow(e){this.collection_windows.splice(e,1),this.delete_window_dialog=!1,this.open_window_panel=null,this.collection_windows.length<1&&(this.show_window_form=!0)},editLV(e){this.edit_lv_index=this.window.data.labs_vitals.indexOf(e),this.edit_lv_obj=JSON.parse(JSON.stringify(e)),this.edit_lv_dialog=!0},editWindow(e){this.pre_edit_window=JSON.parse(JSON.stringify(this.collection_windows[e])),this.window=Object.assign({},this.window,JSON.parse(JSON.stringify(this.collection_windows[e]))),this.edit_window_index=e,this.open_window_panel=null,this.window_edit=!0,this.show_window_form=!0,this.$refs.window_form.resetValidation(),this.$refs.window_form.validate()},isClinicalDate(e){return null!==e&&Object.prototype.hasOwnProperty.call(e,"duster_field_name")},isRPDate(e){return null!==e&&Object.prototype.hasOwnProperty.call(e,"redcap_field_name")},isValidTiming(){return"nonrepeating"===this.window.type?this.isValidNonRepeat():"finite_repeating"===this.window.type?this.isValidFiniteRepeat():"calculated_repeating"===this.window.type&&this.isValidCalcRepeat()},isValidNonRepeat(){if("nonrepeating"===this.window.type&&["date","dttm"].includes(this.window.timing.start_type)&&(this.isClinicalDate(this.window.timing.start)&&this.rp_dates_rcfields.includes(this.window.timing.start_based)||this.isRPDate(this.window.timing.start))){if("hours"===this.window.timing.end_type&&this.window.timing.num_hours>0||"day"===this.window.timing.end_type)return console.log("isValidNonRepeat(): valid, returning true"),!0;if("dttm"===this.window.timing.end_type&&(this.isClinicalDate(this.window.timing.end)&&this.rp_dates_rcfields.includes(this.window.timing.end_based)||this.isRPDate(this.window.timing.end)))return console.log("isValidNonRepeat(): valid, returning true"),!0}return!1},isValidFiniteRepeat(){return!!("finite_repeating"===this.window.type&&this.window.timing.num_instances>1&&(this.isClinicalDate(this.window.timing.start)&&this.rp_dates_rcfields.includes(this.window.timing.start_based)||this.isRPDate(this.window.timing.start))&&("hours"===this.window.timing.type&&this.window.timing.num_hours>0||"days"===this.window.timing.type))},isValidCalcRepeat(){return!!("calculated_repeating"===this.window.type&&(this.isClinicalDate(this.window.timing.start)&&this.rp_dates_rcfields.includes(this.window.timing.start_based)||this.isRPDate(this.window.timing.start))&&(this.isClinicalDate(this.window.timing.end)&&this.rp_dates_rcfields.includes(this.window.timing.end_based)||this.isRPDate(this.window.timing.end))&&("hours"===this.window.timing.type&&this.window.timing.num_hours>0||"days"===this.window.timing.type))},resetNonRepeatEnd(e){e.timing.end=null,e.timing.end_based=this.rp_dates[0].redcap_field_name,"hours"!==e.timing.end_type&&(e.timing.num_hours=null)},resetRepeat(e){"hours"!==e.timing.type&&(e.timing.num_hours=null),"calculated_repeating"!==e.type&&(e.timing.end=null,e.timing.end_based=this.rp_dates[0].redcap_field_name)},resetWindow(e,t){console.log("resetWindow() called."),this[e]=JSON.parse(JSON.stringify({label:null,type:"nonrepeating",timing:{start_type:null,start:null,start_based:"enroll_date",end_type:null,num_hours:null,end:null,end_based:"enroll_date"},aggregate_defaults:{min:!1,max:!1,first:!1,last:!1,closest_start:!1,closest_time:!1,closest_timestamp:"08:00:00"},data:{labs_vitals:[]}})),this.alert_default_agg=!1,this.window_stepper=1,this.$refs[t].resetValidation()},saveCollectionWindowForm(){this.checkDefaultAgg(this.window)?(-1===this.edit_window_index?this.collection_windows.push(JSON.parse(JSON.stringify(this.window))):(this.collection_windows.splice(this.edit_window_index,1,JSON.parse(JSON.stringify(this.window))),this.edit_window_index=-1,this.pre_edit_window=null),this.resetWindow("window","window_form"),this.show_window_form=!1):this.alert_default_agg=!0},setPreset(e){this.window=JSON.parse(JSON.stringify(e)),this.$refs["preset_window"].reset(),console.log(JSON.stringify(e)),console.log("setPreset()"),console.log(JSON.stringify(this.window))}}},ce=_e,pe=(0,A.Z)(ce,oe,de,!1,null,"255e6b83",null),ue=pe.exports,me=a(8926),ge=a(2220),he=function(){var e=this,t=e._self._c;return t(C.Z,{attrs:{step:"5"}},[t(Z.Z,{attrs:{flat:""}},[t(r.ZB,[t("p",[e._v(" Below is an overview of the REDCap instruments and REDCap fields that will be created based on the choices made in previous steps. ")])])],1),t(u.Z,[t(_.Z,{attrs:{cols:"4"}},[t(d.Z,{staticClass:"mb-4",attrs:{color:"secondary",block:""},on:{click:function(t){e.instruments=e.instruments.length>0?[]:Array.from(Array(2+e.config.collection_windows.length).keys())}}},[e._v(" "+e._s(e.instruments.length>0?"Collapse all instruments":"Expand all instruments")+" ")])],1)],1),t(te.Z,{attrs:{multiple:"",accordion:""},model:{value:e.instruments,callback:function(t){e.instruments=t},expression:"instruments"}},[t(X.Z,[t(ee.Z,[e._v("Instrument: Researcher-Provided Info (researcher_provided_info)")]),t(K.Z,[t(Z.Z,{staticClass:"mb-4",attrs:{outlined:""}},[t(r.Qq,[t("h2",[e._v("Identifier")])]),t(y.Z,{attrs:{headers:e.review_id_headers,items:e.config.rp_info.rp_identifiers,"item-key":"label","fixed-header":"",dense:"","hide-default-footer":""},scopedSlots:e._u([{key:"item.format",fn:function(){return[t("span",[e._v("8-digit number (including leading zeros, e.g., '01234567')")])]},proxy:!0}],null,!0)})],1),t(Z.Z,{staticClass:"mb-4",attrs:{outlined:""}},[t(r.Qq,[t("h2",[e._v("Dates")])]),t(y.Z,{attrs:{headers:e.review_date_headers,items:Object.values(e.config.rp_info.rp_dates),"item-key":"label","fixed-header":"",dense:"","hide-default-footer":""},scopedSlots:e._u([{key:"item.format",fn:function({item:a}){return[t("span",[e._v(e._s(a.format)+" ["+e._s("date"==a.format?"YYYY-MM-DD":"YYYY-MM-DD HH:MM:SS")+"]")])]}}],null,!0)})],1)],1)],1),t(X.Z,[t(ee.Z,[e._v("Instrument: Demographics (demographics)")]),t(K.Z,[t(Z.Z,{attrs:{outlined:""}},[t(y.Z,{attrs:{headers:e.review_demo_headers,items:e.config.demographics,"item-key":"label","no-data-text":"No demographics have been selected.","fixed-header":"",dense:"","hide-default-footer":""}})],1)],1)],1),e._l(e.config.collection_windows,(function(a){return t(X.Z,{key:a.id},[t(ee.Z,[e._v("Instrument: "+e._s(a.label)+" ("+e._s(a.form_name)+")")]),t(K.Z,[t(Z.Z,{staticClass:"mb-4",attrs:{outlined:""}},[t(r.Qq,[t("h2",[e._v("Timing")])]),t(me.Z,{attrs:{"three-line":""}},[t(ge.km,[t(ge.V9,[e._v("Start")]),t(ge.oZ,[e._v("Label: "+e._s(a.timing.start.label))]),t(ge.oZ,[e._v("REDCap field name: "+e._s(a.timing.start.redcap_field_name))])],1)],1),t(me.Z,{attrs:{"three-line":""}},[t(ge.km,[t(ge.V9,[e._v("End")]),t(ge.oZ,[e._v("Label: "+e._s(a.timing.end.label))]),t(ge.oZ,[e._v("REDCap field name: "+e._s(a.timing.end.redcap_field_name))])],1)],1)],1),t(Z.Z,{staticClass:"mb-4",attrs:{outlined:""}},[t(r.Qq,[t("h2",[e._v("Labs")])]),t(y.Z,{attrs:{headers:e.review_cw_headers,items:a.data.labs,"item-key":"label","no-data-text":"No labs have been selected.","fixed-header":"",dense:"","hide-default-footer":""}})],1),t(Z.Z,{staticClass:"mb-4",attrs:{outlined:""}},[t(r.Qq,[t("h2",[e._v("Vitals")])]),t(y.Z,{attrs:{headers:e.review_cw_headers,items:a.data.vitals,"item-key":"label","no-data-text":"No vitals have been selected.","fixed-header":"",dense:"","hide-default-footer":""}})],1)],1)],1)}))],2),e.save_error?t("div",[t(z.Z,{attrs:{type:"error"}},[t("span",{domProps:{innerHTML:e._s(e.save_error)}})])],1):e._e(),t(d.Z,{staticClass:"mt-4",attrs:{color:"primary"},on:{click:e.createProject}},[e._v(" Create Project ")])],1)},fe=[],we={name:"ReviewStep",props:{collection_windows:Array,create_project_url:String,demographics:Object,project_info:Object,redcap_csrf_token:String,rp_dates:Array},data:function(){return{instruments:[],review_id_headers:[{text:"Label",value:"label",sortable:!1},{text:"REDCap field name",value:"redcap_field_name",sortable:!1},{text:"Format",value:"format",sortable:!1}],review_date_headers:[{text:"Label",value:"label"},{text:"REDCap field name",value:"redcap_field_name"},{text:"Format",value:"format"}],review_demo_headers:[{text:"Label",value:"label"},{text:"REDCap field name",value:"redcap_field_name"}],review_cw_headers:[{text:"Label",value:"label"},{text:"REDCap field name",value:"redcap_field_name"}],save_error:null}},computed:{config:{get:function(){let e={rp_info:{rp_identifiers:[{redcap_field_name:"mrn",label:"Medical Record Number (MRN)",format:"text"}],rp_dates:{}},demographics:[],collection_windows:[]},t=[];this.rp_dates.forEach((e=>{t.push([e.redcap_field_name,{redcap_field_name:e.redcap_field_name,label:e.label,format:e.format}])})),e.rp_info.rp_dates=Object.fromEntries(t),this.demographics.selected.forEach((t=>{e.demographics.push({duster_field_name:t.duster_field_name,redcap_field_name:t.redcap_field_name,label:t.label,format:"text"})}));let a=[];return this.collection_windows.forEach(((e,t)=>{let i={label:e.label,form_name:this.getFormName(e.label,a.map((e=>e.form_name))),type:e.type,timing:{},data:{labs:[],vitals:[]}},s=e.timing;if("nonrepeating"===e.type){let e=null!==s.start&&Object.prototype.hasOwnProperty.call(s.start,"duster_field_name")?s.start.duster_field_name:null,a="cw"+t+"_start_dttm",r=null!==e?s.start_based:s.start.redcap_field_name,n=s.start.label;"date"!==s.start_type&&"date"!==s.start.format||(n="00:00:00 on the Calendar Day of "+s.start.label);let l=null!==s.end&&Object.prototype.hasOwnProperty.call(s.end,"duster_field_name")?s.end.duster_field_name:null,o="cw"+t+"_end_dttm",d=null;"dttm"===s.end_type&&(d=null!==l?s.end_based:s.end.redcap_field_name);let _="";"dttm"===s.end_type?_="date"===s.end.format?"Midnight on the Calendar Day of "+s.end.label:s.end.label:"day"===s.end_type?_="Midnight on the Calendar Day of "+s.start.label:"hours"===s.end_type&&(_=s.num_hours+" hours after "+n);let c={start:{type:s.start_type,duster_field_name:e,redcap_field_name:a,rp_date:r,label:n},end:{type:s.end_type,num_hours:s.num_hours,duster_field_name:l,redcap_field_name:o,rp_date:d,label:_}};i.timing=c}let r=e.data.labs_vitals;r.forEach((a=>{let s=[],r="",n=e.aggregate_defaults;!1===a.aggregates.default&&(n=a.aggregates),!0===n.min&&(r=a.duster_field_name+"_min_"+t,s.push({duster_field_name:a.duster_field_name,redcap_field_name:r,label:"Minimum "+a.label,format:"text",aggregate:"min_agg"})),!0===n.max&&(r=a.duster_field_name+"_max_"+t,s.push({duster_field_name:a.duster_field_name,redcap_field_name:r,label:"Maximum "+a.label,format:"text",aggregate:"max_agg"})),!0===n.first&&(r=a.duster_field_name+"_first_"+t,s.push({duster_field_name:a.duster_field_name,redcap_field_name:r,label:"First "+a.label,format:"text",aggregate:"first_agg"})),!0===n.last&&(r=a.duster_field_name+"_last_"+t,s.push({duster_field_name:a.duster_field_name,redcap_field_name:r,label:"Last "+a.label,format:"text",aggregate:"last_agg"})),n.closest_start,n.closest_time,"labs"===a.category?i.data.labs.push(...s):i.data.vitals.push(...s)})),a.push(i)})),e.collection_windows=a,e}}},methods:{createProject(){let e={surveys_enabled:this.project_info.surveys_enabled,repeatforms:this.project_info.repeatforms,scheduling:this.project_info.scheduling,randomization:this.project_info.randomization,app_title:this.project_info.app_title,purpose:this.project_info.purpose,project_pi_firstname:this.project_info.project_pi_firstname,project_pi_mi:this.project_info.project_pi_mi,project_pi_lastname:this.project_info.project_pi_lastname,project_pi_email:this.project_info.project_pi_email,project_pi_alias:this.project_info.project_pi_alias,project_irb_number:this.project_info.project_irb_number,purpose_other:this.project_info.purpose_other,project_note:this.project_info.project_note,projecttype:this.project_info.projecttype,repeatforms_chk:this.project_info.repeatforms_chk,project_template_radio:this.project_info.project_template_radio,config:this.config},t=new FormData;t.append("redcap_csrf_token",this.redcap_csrf_token),t.append("data",JSON.stringify(e));let a=this;b.ZP.post(this.create_project_url,t).then((function(e){console.log("ajax response"),console.log(e),e.data.indexOf("Uncaught Error")>-1||e.data.indexOf("Error message")>-1?(console.log("Found Error"),a.save_error=e.data):(window.location.href=e.data,console.log(e.data))})).catch((function(e){a.save_error=e.message,console.log("Catch: "+e)}))},getFormName(e,t){let i=e.trim().toLowerCase();i=i.replaceAll(" ","_"),i=i.replaceAll(/[^a-z_0-9]/g,"");while(-1!=i.indexOf("__"))i=i.replaceAll("__","_");while("_"==i.substring(0,1))i=i.substring(1);while("_"==i.substring(i.length-1))i=i.substring(0,i.length-1);while(/^\d$/g.test(i.substring(0,1)))i=i.substring(1);while("_"==i.substring(0,1))i=i.substring(1);if(/^\d$/.test(i.substring(0,1))||""==i){let e=a(2568);i=e(i).replaceAll(/[0-9]/g,"").substring(0,4)+i}i=i.substring(0,50);let s=["researcher_provided_information","demographics"].concat(t);while(s.includes(i))i=i.substring(0,44),i+=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString().substring(0,6);return i}},watch:{config:function(){this.instruments=[]}}},ve=we,be=(0,A.Z)(ve,he,fe,!1,null,"14786f78",null),Ze=be.exports,ye={name:"NewProjectStepper",data:function(){return{urls:{create_project:"",metadata:"",new_project_intro:""},project_info:{surveys_enabled:"",repeatforms:"",scheduling:"",randomization:"",app_title:"",purpose:"",project_pi_firstname:"",project_pi_mi:"",project_pi_lastname:"",project_pi_email:"",project_pi_alias:"",project_irb_number:"",purpose_other:"",project_note:"",projecttype:"",repeatforms_chk:"",project_template_radio:""},redcap_csrf_token:"",clinical_dates:[],collection_windows:[],metadata_loaded:!1,step:1,show_window_form:!1,rp_identifiers:[{label:"MRN",redcap_field_name:"mrn",format:"8-digit number (including leading zeros, e.g., '01234567')"}],rp_dates:[{id:0,label:"Study Enrollment Date",redcap_field_name:"enroll_date",format:"date"}],demographics:{options:[],selected:[]},labs:[],vitals:[]}},mounted(){const e=JSON.parse(localStorage.getItem("postObj"));localStorage.removeItem("postObj"),this.urls.create_project=e.create_project_url,this.urls.metadata=e.metadata_url,this.urls.new_project_intro=e.new_project_intro_url,this.project_info.surveys_enabled=e.surveys_enabled,this.project_info.repeatforms=e.repeatforms,this.project_info.scheduling=e.scheduling,this.project_info.randomization=e.randomization,this.project_info.app_title=e.app_title,this.project_info.purpose=e.purpose,this.project_info.project_pi_firstname=e.project_pi_firstname,this.project_info.project_pi_mi=e.project_pi_mi,this.project_info.project_pi_lastname=e.project_pi_lastname,this.project_info.project_pi_email=e.project_pi_email,this.project_info.project_pi_alias=e.project_pi_alias,this.project_info.project_irb_number=e.project_irb_number,this.project_info.purpose_other=e.purpose_other,this.project_info.project_note=e.project_note,this.project_info.projecttype=e.projecttype,this.project_info.repeatforms_chk=e.repeatforms_chk,this.project_info.project_template_radio=e.project_template_radio,this.redcap_csrf_token=e.redcap_csrf_token,b.ZP.get(this.urls.metadata).then((e=>{console.log(e.data);for(const t of e.data.demographics)this.demographics.options.push({label:t.label,duster_field_name:t.duster_field_name,redcap_field_name:t.duster_field_name});this.clinical_dates=e.data.clinical_dates;for(const t of e.data.labs)this.labs.push({duster_field_name:t.duster_field_name,label:t.label,category:t.category});for(const t of e.data.vitals)this.vitals.push({duster_field_name:t.duster_field_name,label:t.label,category:t.category});this.metadata_loaded=!0}))},methods:{backStep(){this.step>1&&(this.step-=1)},nextStep(){this.step<5&&(this.step+=1,this.step)}},components:{ResearcherProvidedInfoStep:L,DemographicsStep:I,ClinicalDatesStep:H,DataCollectionWindowsStep:ue,ReviewStep:Ze}},xe=ye,je=(0,A.Z)(xe,w,v,!1,null,"2dcb383a",null),De=je.exports,ke={name:"App",components:{NewProjectStepper:De},data:()=>({metadata_loaded:!0})},Ce=ke,Se=(0,A.Z)(Ce,l,o,!1,null,null,null),Ee=Se.exports,Ne=a(7846);i.ZP.use(Ne.Z);var Re=new Ne.Z({}),Oe=a(2568),Ae=a.n(Oe);i.ZP.config.productionTip=!1,new i.ZP({vuetify:Re,axios:b.ZP,md5:Ae(),render:e=>e(Ee)}).$mount("#app")}},t={};function a(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={id:i,exports:{}};return e[i](r,r.exports,a),r.exports}a.m=e,function(){var e=[];a.O=function(t,i,s,r){if(!i){var n=1/0;for(_=0;_<e.length;_++){i=e[_][0],s=e[_][1],r=e[_][2];for(var l=!0,o=0;o<i.length;o++)(!1&r||n>=r)&&Object.keys(a.O).every((function(e){return a.O[e](i[o])}))?i.splice(o--,1):(l=!1,r<n&&(n=r));if(l){e.splice(_--,1);var d=s();void 0!==d&&(t=d)}}return t}r=r||0;for(var _=e.length;_>0&&e[_-1][2]>r;_--)e[_]=e[_-1];e[_]=[i,s,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,i){var s,r,n=i[0],l=i[1],o=i[2],d=0;if(n.some((function(t){return 0!==e[t]}))){for(s in l)a.o(l,s)&&(a.m[s]=l[s]);if(o)var _=o(a)}for(t&&t(i);d<n.length;d++)r=n[d],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(_)},i=self["webpackChunknew_project"]=self["webpackChunknew_project"]||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))}();var i=a.O(void 0,[998],(function(){return a(2747)}));i=a.O(i)})();